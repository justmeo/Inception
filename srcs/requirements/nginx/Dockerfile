FROM debian:12.7-slim

RUN apt-get update \
 && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
      nginx openssl ca-certificates tzdata \
 && rm -rf /var/lib/apt/lists/*

# Provide strong DH params (can also be generated by Makefile once and copied in)
COPY conf/dhparam.pem /etc/nginx/dhparam.pem

# Entrypoint generates self-signed cert (if missing) and renders vhost
COPY tools/nginx-entrypoint.sh /usr/local/bin/nginx-entrypoint.sh
RUN chmod +x /usr/local/bin/nginx-entrypoint.sh

WORKDIR /etc/nginx
EXPOSE 443
ENTRYPOINT ["/usr/local/bin/nginx-entrypoint.sh"]
CMD ["nginx", "-g", "daemon off;"]